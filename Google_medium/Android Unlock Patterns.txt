/*

https://algo.monster/liteproblems/351

https://leetcode.com/problems/android-unlock-patterns/description/

*/


#include <bits/stdc++.h>
using namespace std;


int dfs(vector<vector<int>>& crossing,int m,int n,int curr_len,int curr_key,vector<bool>& visited){
    
    
    if(curr_len>n){
        return 0;
    }
    visited[curr_key]=true;
    
    int total=(curr_len>=m)?1:0;
    
    for(int next=1;next<=9;next++){
        int intermediate=crossing[curr_key][next];
        
        
        if(visited[next]==false and (intermediate==0 or visited[intermediate]==true)){
            total+=dfs(crossing,m,n,curr_len+1,next,visited);
        }
        
        
    }
    visited[curr_key]=false;
    return total;
    
    
    
}



int main() {
	// your code goes here
	vector<bool> visited(10);
	
	vector<vector<int>> crossing(10,vector<int>(10,0));
	
	//horizontals
	crossing[1][3]=crossing[3][1]=2;
	crossing[4][6]=crossing[6][4]=5;
	crossing[7][9]=crossing[9][7]=8;
	
	//verticals
	crossing[1][7]=crossing[7][1]=4;
	crossing[2][8] = crossing[8][2] = 5;
    crossing[3][9] = crossing[9][3] = 6; 

    // Diagonal crossings
    crossing[1][9] = crossing[9][1] = 5; 
    crossing[3][7] = crossing[7][3] = 5;
	
	int m=4;
	int n=6;
	
	cout<< dfs(crossing,m,n,1,1,visited)*4 + dfs(crossing,m,n,1,2,visited)*4 + dfs(crossing,m,n,1,5,visited);
	
	

}
