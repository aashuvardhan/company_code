/*
https://leetcode.com/problems/sequence-reconstruction/description/



Problem Description
You are given an integer array nums of length n that is a permutation of integers from 1 to n. You also have a 2D array sequences where each sequences[i] is a subsequence of nums.

Your task is to determine if nums is both:

The shortest possible supersequence that contains all given subsequences
The only unique shortest supersequence
A supersequence is a sequence that contains all the given subsequences as its subsequences. A subsequence is derived from a sequence by deleting some or no elements without changing the order of remaining elements.

For example:

Given sequences = [[1,2],[1,3]], there are two possible shortest supersequences: [1,2,3] and [1,3,2]. Since there are multiple valid shortest supersequences, the answer would be false.
Given sequences = [[1,2],[1,3],[1,2,3]], the only shortest supersequence is [1,2,3]. While [1,2,3,4] is also a valid supersequence, it's not the shortest. Since there's only one shortest supersequence, the answer would be true.


*/


#include <bits/stdc++.h>
using namespace std;


bool sequenceReconstruction(vector<int>& nums, vector<vector<int>>& sequences){
    int n=nums.size();
	unordered_map<int,vector<int>> graph;
	
	vector<int> indegree(n,0);
	//converting each sequence to graph nodes of directed graph
	
	for(auto sequence: sequences){
	    for(int i=1;i<sequence.size();i++){
	        //converting to zero based indexing
	        int from=sequence[i-1]-1;
	        int to=sequence[i]-1;
	        
	        graph[from].push_back(to);
	        indegree[to]++;
	        
	    }
	}
	
	queue<int> topo_queue;
	for(int i=0;i<n;i++){
	    if(indegree[i]==0){
	        topo_queue.push(i);
	    }
	}
	
	//things will be unique if and only if we have 1 element to process 
	// in the queue at each time
	while(topo_queue.size()==1){
	    int curr=topo_queue.front();
	    topo_queue.pop();
	    
	    for(auto adj: graph[curr]){
	        indegree[adj]--;
	        if(indegree[adj]==0){
	            topo_queue.push(adj);
	        }
	    }
	    
	}
	
	return topo_queue.size()==0;
    
    
    
}



int main() {
	// your code goes here
	vector<int> nums={1,2,3};
	
	vector<vector<int>> sequences={{1,2},{1,3},{1,2,3}};
	
	cout<<sequenceReconstruction(nums,sequences);
	

}





